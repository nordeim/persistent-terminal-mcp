# Persistent Terminal MCP Server

[简体中文](README.zh-CN.md)

Persistent Terminal MCP Server is a TypeScript implementation of a Model Context
Protocol (MCP) server that keeps terminal sessions alive for AI assistants and
automation flows. It is built on top of [`node-pty`](https://github.com/microsoft/node-pty)
so commands continue running even when the requesting client disconnects.

## Highlights
- **Persistent PTY sessions** – create, reuse, and terminate long-running shells
- **Smart output buffering** – incremental reads plus head, tail, or head-tail
  views with token estimates for large logs
- **Full session management** – statistics, listing, kill signals, and automatic
  cleanup for inactive sessions
- **MCP-ready** – ships with tools, resources, and prompts compatible with
  Claude Desktop, Claude Code, and other MCP clients
- **REST API option** – optional Express server mirrors the MCP functionality
  for non-MCP integrations

## Quick Start
```bash
npm install          # install dependencies
npm run build        # compile TypeScript → dist/
npm start            # launch the MCP server over stdio
```

During development you can run the TypeScript sources directly:
```bash
npm run dev          # MCP server (tsx)
npm run dev:rest     # REST server (tsx)
```

### Example Scripts
```bash
npm run example:basic        # basic lifecycle (create → write → read → kill)
npm run example:smart        # demonstrates head/tail/head-tail reading
npm run test:tools           # exercises every MCP tool end-to-end
npm run test:fixes           # regression tests for recent bug fixes
```

## MCP Tools
| Tool | Purpose |
|------|---------|
| `create_terminal` | Create a persistent terminal session (supports `env`, `shell`, and `cwd`) |
| `create_terminal_basic` | Convenience alias for clients that can only send simple strings |
| `write_terminal` | Send input to a terminal; newline is added automatically if needed |
| `read_terminal` | Retrieve buffered output with smart truncation options |
| `get_terminal_stats` | Inspect buffer size, line counts, estimated tokens, and activity |
| `list_terminals` | Enumerate active sessions and their metadata |
| `kill_terminal` | Terminate a session with an optional signal |

Additional MCP resources and prompts are exposed for listing sessions, viewing
output, and surfacing troubleshooting tips inside compatible clients.

## REST API (Optional)
If you prefer HTTP, start the REST variant:
```bash
npm run start:rest
```
The server listens on port `3001` (configurable) and mirrors the MCP toolset.
Endpoints include `/api/terminals`, `/api/terminals/:id/input`, `/api/terminals/:id/output`,
`/api/terminals/:id/stats`, `/api/terminals`, and `/api/terminals/:id`.

## Project Layout
```
docs/                → consolidated documentation index
scripts/             → helper scripts for local debugging of the MCP server
src/                 → TypeScript source (MCP server, REST API, examples)
dist/                → compiled JavaScript output (generated by `npm run build`)
```

### Documentation Map
All auxiliary material now lives under [`docs/`](docs/README.md):
- Guides for usage, troubleshooting, and MCP configuration
- Client-specific setup notes (Claude Desktop / Claude Code)
- Reference material such as bug-fix reports and technical deep dives
- Chinese-language quick starts and prompt collections

## Contributing
Contributions are welcome! Please open an issue or pull request if you
encounter bugs or have ideas for new capabilities. The
[`CONTRIBUTING.md`](CONTRIBUTING.md) file outlines the recommended workflow and
coding standards.

## License
This project is released under the [MIT License](LICENSE).
